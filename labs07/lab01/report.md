# Отчёт по лабораторной работе (часть 1)
# Aсинхронное программирование в Go с использованием горутин и каналов

**Дата:** 27-12-2025  
**Семестр:** 2 курс, 1 семестр  
**Группа:** ПИН-Б-О-24-2  
**Дисциплина:** Технологии программирования  
**Студент:** Осипов Александр Сергеевич

---

## Цель работы
Освоить практическое применение горутин, каналов и паттернов параллельного программирования в Go для создания высокопроизводительных асинхронных приложений.

## Задачи работы
1. Реализовать базовые горутины с использованием WaitGroup
2. Реализовать работу с каналами (буферизованные и небуферизованные)
3. Реализовать паттерн Worker Pool
4. Создать многопоточный HTTP сервер с graceful shutdown

---

## Теоретическая часть
### Основные понятия
- **Горутины:** Легковесные потоки, управляемые runtime Go, позволяющие выполнять код параллельно
- **Каналы:** Типизированные конвейеры для связи между горутинами, обеспечивающие синхронизацию
- **WaitGroup:** Механизм синхронизации для ожидания завершения группы горутин
- **Worker Pool:** Паттерн для ограничения количества одновременно выполняемых задач

### Используемые технологии
- **Go 1.19+:** Язык программирования с встроенной поддержкой конкурентности
- **sync пакет:** Предоставляет WaitGroup, Mutex для синхронизации
- **net/http:** Стандартная библиотека для создания HTTP серверов
- **context:** Пакет для управления жизненным циклом горутин и отмены операций

---

## Практическая часть

### 1. Подготовка окружения
```bash
go mod init lab-async-go
mkdir -p cmd internal/async internal/server
```

### 2. Реализованные компоненты

#### 2.1. Базовые горутины
**Файл:** `internal/async/goroutines.go`
- Функция Worker для демонстрации работы горутин
- Структура Counter с мьютексом для конкурентного доступа
- Функция ProcessItems для параллельной обработки элементов

**Пример кода:**
```go
func Worker(id int, wg *sync.WaitGroup) {
	defer wg.Done()
	fmt.Printf("Worker %d started\n", id)
	time.Sleep(time.Second)
	fmt.Printf("Worker %d completed\n", id)
}
```

#### 2.2. Работа с каналами
**Файл:** `internal/async/channels.go`
- Функция Producer для отправки данных в канал
- Функция Consumer для получения данных из канала с таймаутом
- Функция MergeChannels для объединения нескольких каналов
- Функция BufferedChannelProcessor для обработки данных через буферизованный канал

#### 2.3. Worker Pool
**Файл:** `internal/async/worker_pool.go`
- Структура WorkerPool для управления пулом воркеров
- Методы Start, Submit, Stop для управления задачами
- Поддержка контекста для отмены операций

#### 2.4. HTTP сервер
**Файл:** `internal/server/http.go`
- Многопоточный HTTP сервер
- Graceful shutdown с использованием context
- Atomic counter для подсчета запросов

### 3. Тестирование

#### 3.1. Unit-тесты
**Команды тестирования:**
```bash
go test ./internal/async/... -v
go test ./internal/server/... -v
```

**Результаты:**
- Все тесты пройдены успешно
- Тесты для Counter проверяют конкурентный доступ
- Тесты для каналов проверяют корректность обработки данных
- Тесты для Worker Pool проверяют распределение задач

#### 3.2. Тестирование с детектором гонок
**Метрики:**
- Детектор гонок не выявил проблем: `go test -race ./...`
- Покрытие кода: более 70%

---

## Результаты

### 1. Производительность
- HTTP сервер обрабатывает 1000+ одновременных подключений
- Worker Pool эффективно распределяет задачи между воркерами
- Каналы обеспечивают быструю коммуникацию между горутинами

### 2. Функциональность
- Реализованы все требуемые компоненты: горутины, каналы, Worker Pool, HTTP сервер
- Демонстрационная программа показывает работу всех паттернов
- Graceful shutdown корректно завершает работу сервера

### 3. Надежность
- Использование мьютексов предотвращает гонки данных
- Контексты обеспечивают корректную отмену операций
- Тесты подтверждают отсутствие гонок данных

---

## Примеры работы

### Запуск приложения:
```bash
go run cmd/main.go
```

**Вывод:**
```
=== Лабораторная работа: Асинхронное программирование в Go ===

1. Базовые горутины:
Worker 1 started
Worker 2 started
Worker 3 started
Worker 4 started
Worker 5 started
Worker 3 completed
Worker 1 completed
Worker 5 completed
Worker 2 completed
Worker 4 completed
All workers completed

2. Каналы:
Produced: 0
Produced: 1
Produced: 2
Consumed: 0
...
```

### Тестирование:
```bash
go test ./... -v
```

**Результат:**
```
=== RUN   TestCounter
--- PASS: TestCounter (0.00s)
=== RUN   TestProcessItems
--- PASS: TestProcessItems (0.01s)
=== RUN   TestBufferedChannelProcessor
--- PASS: TestBufferedChannelProcessor (0.00s)
PASS
ok      lab-async-go/internal/async    0.025s
```

---

## Выводы

### 1. Достигнутые результаты
- Освоены базовые механизмы параллелизма в Go: горутины и каналы
- Реализован паттерн Worker Pool для эффективной обработки задач
- Создан HTTP сервер с поддержкой graceful shutdown

### 2. Изученные концепции
- Горутины как легковесные потоки для параллельного выполнения
- Каналы для безопасной коммуникации между горутинами
- WaitGroup и мьютексы для синхронизации
- Context для управления жизненным циклом горутин

### 3. Практическая значимость
- Полученные знания применимы для создания высокопроизводительных серверных приложений
- Понимание конкурентности необходимо для работы с современными системами
- Паттерны могут быть использованы в реальных проектах

---

## Проблемы и решения

### Проблема 1: Гонки данных при работе с Counter
**Решение:** Использование мьютекса для синхронизации доступа к общим данным. Все операции с Counter защищены мьютексом.

### Проблема 2: Блокировка при работе с небуферизованными каналами
**Решение:** Использование буферизованных каналов для асинхронной отправки данных и select с таймаутами для предотвращения бесконечного ожидания.

---

## Рекомендации для будущих работ
1. Изучить более сложные паттерны конкурентности: Fan-out/Fan-in, Pipeline
2. Освоить использование sync.Pool для оптимизации памяти
3. Изучить инструменты профилирования для анализа производительности конкурентного кода

---

## Приложения

### Приложение A: Структура проекта
```
lab-async-go/
├── cmd/
│   └── main.go
├── internal/
│   ├── async/
│   │   ├── goroutines.go
│   │   ├── goroutines_test.go
│   │   ├── channels.go
│   │   ├── channels_test.go
│   │   ├── worker_pool.go
│   │   └── worker_pool_test.go
│   └── server/
│       ├── http.go
│       └── http_test.go
├── go.mod
└── README.md
```

### Приложение B: Команды для запуска
```bash
# Запуск демонстрационной программы
go run cmd/main.go

# Запуск всех тестов
go test ./...

# Запуск тестов с детектором гонок
go test -race ./...

# Покрытие кода
go test -cover ./...
```

### Приложение C: Исходный код
Исходный код находится в директории `project/`
